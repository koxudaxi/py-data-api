dist: xenial
language: python
python:
  - '3.6'
  - '3.7'
install:
- pip install ".[all]"
cache: pip

script:
- mypy pydataapi --disallow-untyped-defs --ignore-missing-imports
- black pydataapi tests --check --skip-string-normalization
- isort --recursive --check-only -w 88  --combine-as --thirdparty pydataapi pydataapi tests -m 3 -tc
- pytest --cov=pydataapi tests
- cp README.md docs/index.md && mkdocs build --verbose --clean --strict

after_success:
- codecov

deploy:
  - provider: pages
    skip_cleanup: true
    github_token: $GITHUB_TOKEN
    local_dir: site
    on:
      branch: master
      python: '3.7'
  - provider: pypi
    user: $PYPI_USERNAME
    password: $PYPI_PASSWORD
    skip_existing: true
    distributions: sdist bdist_wheel
    on:
      tags: true
      python: '3.7'